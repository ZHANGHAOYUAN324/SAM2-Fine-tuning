# åŸºäºSAM2çš„å¿ƒè„è…”å®¤CTåˆ†å‰²é¡¹ç›® ğŸ«€

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Python 3.8+](https://img.shields.io/badge/python-3.8+-blue.svg)](https://www.python.org/downloads/)
[![SAM2](https://img.shields.io/badge/SAM-2.0-green.svg)](https://github.com/facebookresearch/segment-anything-2)

å¾®è°ƒSegment Anything Model 2 (SAM2)ç”¨äºå¿ƒè„CTæ‰«æè…”å®¤åˆ†å‰²ä»»åŠ¡ã€‚æœ¬é¡¹ç›®æä¾›äº†ç”¨äºè®­ç»ƒSAM2æ¨¡å‹è¿›è¡Œå¿ƒè„è…”å®¤åˆ†å‰²çš„å·¥å…·å’ŒæŒ‡å—ã€‚

## ğŸ“‹ ç›®å½•

- [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
- [ç¯å¢ƒè¦æ±‚](#ç¯å¢ƒè¦æ±‚)
- [å®‰è£…æ­¥éª¤](#å®‰è£…æ­¥éª¤)
- [æ•°æ®é›†å‡†å¤‡](#æ•°æ®é›†å‡†å¤‡)
- [ä½¿ç”¨æ–¹æ³•](#ä½¿ç”¨æ–¹æ³•)
- [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)

## ğŸ“Š é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®ä¸“æ³¨äºå¿ƒè„CTæ‰«æå›¾åƒä¸­ä»¥ä¸‹è…”å®¤å’Œç»„ç»‡çš„ç²¾ç¡®åˆ†å‰²:
- LA (å·¦å¿ƒæˆ¿)
- RA (å³å¿ƒæˆ¿)
- LV (å·¦å¿ƒå®¤)
- RV (å³å¿ƒå®¤)
- å¿ƒè‚Œ (Myocardium)

æ”¯æŒä¸åŒè§†è§’çš„å¿ƒè„CTæ‰«æ:
- a2c (ä¸¤è…”å®¤è§†å›¾)
- a3c (ä¸‰è…”å®¤è§†å›¾)
- a4c (å››è…”å®¤è§†å›¾)

## ğŸ”§ ç¯å¢ƒè¦æ±‚

- Python 3.8+
- CUDAæ”¯æŒçš„GPU (æ¨è)
- Git
- Jupyter Notebook
- æ‰€éœ€PythonåŒ…(è‡ªåŠ¨å®‰è£…)

## ğŸš€ å®‰è£…æ­¥éª¤

1. å…‹éš†æ­¤ä»“åº“:
```bash
git clone https://github.com/yourusername/heart_chambers_sam2.git
cd heart_chambers_sam2
```

2. è¿è¡Œå®‰è£…è„šæœ¬:
```bash
chmod +x installation.sh
./installation.sh
```

æ­¤è„šæœ¬ä¼š:
- å…‹éš†å¹¶å®‰è£…SAM2
- ä¸‹è½½å¿…è¦çš„æ¨¡å‹æ£€æŸ¥ç‚¹
- è®¾ç½®è®­ç»ƒç¯å¢ƒ
- å®‰è£…æ‰€éœ€ä¾èµ–
- åˆ›å»ºæ•°æ®å’Œæ¨¡å‹ç›®å½•

## ğŸ“Š æ•°æ®é›†å‡†å¤‡

1. å‡†å¤‡æŒ‰è§†è§’åˆ†ç±»çš„å¿ƒè„CTæ‰«æå›¾åƒå’Œå¯¹åº”çš„JSONæ ‡æ³¨æ–‡ä»¶:
   ```
   data/heart_chambers_dataset/
   â”œâ”€â”€ a2c/  # ä¸¤è…”å®¤è§†å›¾æ•°æ®
   â”‚   â”œâ”€â”€ PatientA0001_a2c_27.png
   â”‚   â”œâ”€â”€ PatientA0001_a2c_27.json
   â”‚   â””â”€â”€ ...
   â”œâ”€â”€ a3c/  # ä¸‰è…”å®¤è§†å›¾æ•°æ®
   â”‚   â”œâ”€â”€ PatientA0001_a3c_15.png
   â”‚   â”œâ”€â”€ PatientA0001_a3c_15.json
   â”‚   â””â”€â”€ ...
   â””â”€â”€ a4c/  # å››è…”å®¤è§†å›¾æ•°æ®
       â”œâ”€â”€ PatientA0001_a4c_42.png
       â”œâ”€â”€ PatientA0001_a4c_42.json
       â””â”€â”€ ...
   ```

2. JSONæ ‡æ³¨æ ¼å¼ (Labelmeæ ¼å¼):
   ```json
   {
     "version": "3.16.7",
     "flags": {},
     "shapes": [
       {
         "label": "LV",
         "points": [[x1, y1], [x2, y2], ...],
         "shape_type": "polygon"
       },
       {
         "label": "LA",
         "points": [[x1, y1], [x2, y2], ...],
         "shape_type": "polygon"
       },
       {
         "label": "M",
         "points": [[x1, y1], [x2, y2], ...],
         "shape_type": "polygon"
       }
     ],
     "imagePath": "PatientA0001_a2c_27.png"
   }
   ```

3. æ–‡ä»¶å‘½åè§„èŒƒ:
   - æ–‡ä»¶åä¸­åº”åŒ…å«ç—…äººID (ä¾‹å¦‚ PatientA0001)
   - æ–‡ä»¶åä¸­åº”æ ‡æ˜è§†è§’ç±»å‹ (a2c, a3c, a4c)
   - æ¯ä¸ªå›¾åƒæ–‡ä»¶å¿…é¡»æœ‰å¯¹åº”çš„åŒåJSONæ ‡æ³¨æ–‡ä»¶

## ğŸ’» ä½¿ç”¨æ–¹æ³•

1. è¿›å…¥å¾®è°ƒç›®å½•:
```bash
cd segment-anything-2/src-finetuning
```

2. å¯åŠ¨å¹¶è¿è¡Œå¾®è°ƒJupyterç¬”è®°æœ¬:
```bash
jupyter notebook heart_chambers_fine_tune.ipynb
```

3. æŒ‰ç…§ç¬”è®°æœ¬ä¸­çš„è¯´æ˜:
   - åŠ è½½å¹¶é¢„å¤„ç†æ•°æ®
   - é…ç½®è®­ç»ƒå‚æ•°
   - è®­ç»ƒæ¨¡å‹
   - è¯„ä¼°ç»“æœ
   - å¯è§†åŒ–ä¸åŒè§†è§’çš„åˆ†å‰²ç»“æœ

## ğŸ”§ å¾®è°ƒæµç¨‹
![å¾®è°ƒæµç¨‹å›¾](./heart_chambers_finetuning_schema.jpg)

## ğŸ“ é¡¹ç›®ç»“æ„

```
.
â”œâ”€â”€ installation.sh                          # å®‰è£…è„šæœ¬
â”œâ”€â”€ HeartChambersSAMTrainer.py               # å¿ƒè„è…”å®¤SAMè®­ç»ƒå™¨
â”œâ”€â”€ heart_chambers_fine_tune.ipynb           # è®­ç»ƒå’Œè¯„ä¼°Jupyterç¬”è®°æœ¬
â”œâ”€â”€ data/                                    # æ•°æ®ç›®å½•
â”‚   â””â”€â”€ heart_chambers_dataset/
â”‚       â”œâ”€â”€ a2c/                             # ä¸¤è…”å®¤è§†å›¾æ–‡ä»¶
â”‚       â”œâ”€â”€ a3c/                             # ä¸‰è…”å®¤è§†å›¾æ–‡ä»¶
â”‚       â””â”€â”€ a4c/                             # å››è…”å®¤è§†å›¾æ–‡ä»¶
â””â”€â”€ segment-anything-2/                      # å®‰è£…åç”Ÿæˆçš„SAM2ä»£ç ç›®å½•
    â”œâ”€â”€ checkpoints/                         # æ¨¡å‹æ£€æŸ¥ç‚¹ç›®å½•
    â””â”€â”€ src-finetuning/                      # å¾®è°ƒä»£ç ç›®å½•
        â”œâ”€â”€ HeartChambersSAMTrainer.py       # è®­ç»ƒå™¨ä»£ç å‰¯æœ¬
        â”œâ”€â”€ heart_chambers_fine_tune.ipynb   # ç¬”è®°æœ¬å‰¯æœ¬
        â””â”€â”€ models/                          # ä¿å­˜è®­ç»ƒåæ¨¡å‹çš„ç›®å½•
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. æ ‡ç­¾æ˜ å°„:
   - "LA" - å·¦å¿ƒæˆ¿
   - "RA" - å³å¿ƒæˆ¿
   - "LV" - å·¦å¿ƒå®¤
   - "RV" - å³å¿ƒå®¤
   - "M" æˆ– "myocardium" - å¿ƒè‚Œ

2. æ•°æ®åˆ†å‰²ç­–ç•¥:
   - ç³»ç»Ÿä¼šè‡ªåŠ¨æŒ‰ç—…äººIDåˆ†å‰²è®­ç»ƒé›†å’Œæµ‹è¯•é›†
   - åŒä¸€ç—…äººçš„æ‰€æœ‰è§†è§’æ•°æ®éƒ½ä¼šè¢«åˆ†åˆ°ç›¸åŒçš„é›†åˆä¸­
   - ç¡®ä¿æ¯ä¸ªç—…äººéƒ½æœ‰è¶³å¤Ÿæ•°é‡çš„ä¸åŒè§†è§’å›¾åƒ

3. æ¨¡å‹é€‰æ‹©:
   - é»˜è®¤ä½¿ç”¨SAM2 Hiera Smallæ¨¡å‹
   - å¯ä»¥åœ¨notebooksä¸­ä¿®æ”¹é…ç½®ä½¿ç”¨å…¶ä»–æ¨¡å‹

---
åŸºäºå¿ƒè„åŒ»å­¦å›¾åƒåˆ†æåˆ›å»º
